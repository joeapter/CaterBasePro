{% load i18n %}
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>PP Flat Estimate</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; color: #0f172a; margin: 0; padding: 24px; }
        h1, h2, h3, h4 { margin: 0 0 6px; }
        .estimate-sheet { background: #f8fafc; border-radius: 14px; padding: 20px; box-shadow: 0 10px 30px rgba(15,23,42,0.12); }
        .info-row { display: flex; gap: 16px; margin-bottom: 16px; }
        .info-card { flex: 1; background: #fff; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0; }
        .meal-card { background: #fff; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 12px; }
        .meal-category h4 { margin: 0 0 4px; }
        .meal-category ul { margin: 0; padding-left: 16px; }
        .summary-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
        .summary-table td, .summary-table th { padding: 8px; border-bottom: 1px solid #e2e8f0; }
        .summary-table th { text-align: left; }
        .totals { margin-top: 18px; background: #fff; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .muted { color: #475569; font-size: 0.95rem; }
    </style>
</head>
<body>
    <div class="estimate-sheet">
        <header style="margin-bottom:14px;">
            <h1>{% if estimate.is_invoice %}{% translate 'Invoice' %}{% else %}{% translate 'Estimate' %}{% endif %}</h1>
            <p class="muted">{% translate 'PP Flat Estimate' %}</p>
        </header>

        <div class="info-row">
            <div class="info-card">
                <h4>{% translate 'Client details' %}</h4>
                <p style="margin:0;">
                    <strong>{{ estimate.customer_name }}</strong><br>
                    {% if estimate.customer_phone %}{{ estimate.customer_phone }}<br>{% endif %}
                    {% if estimate.customer_email %}{{ estimate.customer_email }}{% endif %}
                </p>
            </div>
            <div class="info-card">
                <h4>{% translate 'Event' %}</h4>
                <p style="margin:0;">
                    {{ estimate.event_type|default:"Event" }}<br>
                    {% if estimate.event_date %}{{ estimate.event_date|date:"M j, Y" }}<br>{% endif %}
                    {{ estimate.event_location|default:"" }}
                </p>
            </div>
        </div>

        <section>
            <h2>{% translate 'Menu Selection' %}</h2>
            {% if meal_sections %}
                {% for meal in meal_sections %}
                    <article class="meal-card">
                        <h3>{{ meal.name }}</h3>
                        {% if meal.categories %}
                            {% for category in meal.categories %}
                                <div class="meal-category">
                                    <h4>{{ category.name }}</h4>
                                    <ul>
                                        {% for choice in category.choices %}
                                            <li>{{ choice.menu_item.name }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endfor %}
                        {% endif %}
                        {% if meal.kids_categories and meal.kids_total %}
                            <div class="meal-category">
                                <h4>{% translate 'Kids' %}</h4>
                                {% for category in meal.kids_categories %}
                                    <strong>{{ category.name }}</strong>
                                    <ul>
                                        {% for choice in category.choices %}
                                            <li>{{ choice.menu_item.name }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </article>
                {% endfor %}
            {% else %}
                <p class="muted">{% translate 'No menu items selected yet.' %}</p>
            {% endif %}
        </section>

        {% if extra_lines %}
            <section class="totals">
                <h3>{% translate 'Decor & Extras' %}</h3>
                <table class="summary-table">
                    <tbody>
                        {% for line in extra_lines %}
                            <tr>
                                <td>{{ line.extra_item.name }}</td>
                                <td>{{ line.quantity }}</td>
                                <td class="muted">{{ line.notes }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>
        {% endif %}

        <section class="totals">
            <h3>{% translate 'Summary' %}</h3>
            <table class="summary-table">
                <tbody>
                    <tr>
                        <th>{% translate 'Total guests' %}</th>
                        <td style="text-align:right;">{{ total_guests }}</td>
                    </tr>
                    <tr>
                        <th>{% translate 'Flat price per person' %}</th>
                        <td style="text-align:right;">{{ per_person_flat }} {{ estimate.currency }}</td>
                    </tr>
                    <tr>
                        <th>{% translate 'Total' %}</th>
                        <td style="text-align:right;">{{ estimate.grand_total }} {{ estimate.currency }}</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </div>

    {% if auto_print %}
        <script>window.addEventListener('load', function(){ window.print(); });</script>
    {% endif %}
</body>
</html>
